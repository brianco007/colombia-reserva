<!-- REVIEWS SECTION -->
<div>
  @if(isItAnOwner){
    <div class="font-semibold bg-slate-900 rounded-lg text-white p-2"> Estos son los comentarios que han dejado tus clientes 👇</div>
  }@else {
    <div class="font-semibold bg-slate-900 rounded-lg text-white p-2"> ¿Qué te pareció el servicio en  {{ businessName }}? Cuéntanos aquí abajo 👇</div>
  }

  <!-- N° of comments and add btn -->
  <div class="border-b border-b-2 border-slate-900 text-lg py-5 font-semibold flex items-center justify-between">
    <h2>{{ businessReviews.length }} Comentarios </h2>
    
    @if(!isItAnOwner){
      <div class="flex items-center  p-2 rounded-lg cursor-pointer gap-1" (click)="showReviewsForm = true">
        <h3 class="text-sm hover:text-slate-500 duration-200">Agregar Comentario</h3>
        <svg width="20px" height="20px" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--twemoji" preserveAspectRatio="xMidYMid meet"><path fill="#31373D" d="M31 15H21V5a3 3 0 1 0-6 0v10H5a3 3 0 1 0 0 6h10v10a3 3 0 1 0 6 0V21h10a3 3 0 1 0 0-6z"></path></svg>
      </div>
    }
  </div>

  <!-- Reviews cards -->
  <div class="grid gap-4 p-5">
    <app-loader *ngIf="loading"/>
    @for(review of businessReviews; track review._id){
      <div class="bg-white p-5 rounded-lg shadow-lg shadow-gray-200" *ngIf="!loading">
        <div class="flex items-center">
          <svg width="60px" height="50px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12.0002 8C11.1718 8 10.5002 8.67157 10.5002 9.5C10.5002 10.3284 11.1718 11 12.0002 11C12.8286 11 13.5002 10.3284 13.5002 9.5C13.5002 8.67157 12.8286 8 12.0002 8ZM8.50018 9.5C8.50018 7.567 10.0672 6 12.0002 6C13.9332 6 15.5002 7.567 15.5002 9.5C15.5002 11.433 13.9332 13 12.0002 13C10.0672 13 8.50018 11.433 8.50018 9.5Z" fill="#4296FF"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M6 18C6.00478 18.1073 6.00044 18.0205 6.00044 18.0205L6.00048 18.0222L6.00056 18.0259L6.0008 18.0341L6.00157 18.054C6.00225 18.0688 6.00326 18.0866 6.00478 18.1073C6.00783 18.1486 6.01294 18.2014 6.02151 18.2642C6.03862 18.3895 6.06978 18.5561 6.12678 18.7504C6.2409 19.1392 6.4606 19.6447 6.88176 20.1444C7.75153 21.1765 9.31667 22 12.0001 22C14.4911 22 16.0226 21.2914 16.9304 20.3527C17.8205 19.4323 17.9691 18.436 17.9945 18.123C18.014 17.8823 17.955 17.6735 17.8751 17.5137C17.1048 15.9732 15.5302 15 13.8078 15H10.2363C8.48712 15 6.88806 15.9883 6.1058 17.5528L6 18ZM8.04522 18.185L8.04584 18.1871C8.09681 18.3608 8.20021 18.6053 8.4111 18.8556C8.80544 19.3235 9.74023 20 12.0001 20C14.1057 20 15.0583 19.4116 15.4927 18.9623C15.7742 18.6713 15.9006 18.3745 15.9569 18.1796C15.4928 17.45 14.6845 17 13.8078 17H10.2363C9.34631 17 8.52487 17.4513 8.04522 18.185Z" fill="#4296FF"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12Z" fill="#152C70"/>
          </svg>
          <div>
            <p class="text-gray-400"> {{ review.createdAt }} </p>
            <p> {{ "⭐".repeat(review.stars) }} </p>
          </div>
        </div>
        <p class="mt-4"> "{{ review.comment }}" </p>
      </div>
    }
  </div>

  <!-- Reviews Form Modal-->
  @if(showReviewsForm){
    <div class="fixed top-0 bottom-0 right-0 left-0 bg-black bg-opacity-70 flex items-center justify-center"  >
      <form class="bg-white w-full max-w-[300px] p-7 flex flex-col relative rounded-lg overflow-x-hidden" (submit)="handleReviewsSubmit()">
        <!-- close btn -->
         <div (click)="onBtnClose()">
           <svg width="30px" height="30px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="absolute top-3 right-3 cursor-pointer">
             <path fill-rule="evenodd" clip-rule="evenodd" d="M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12ZM8.96963 8.96965C9.26252 8.67676 9.73739 8.67676 10.0303 8.96965L12 10.9393L13.9696 8.96967C14.2625 8.67678 14.7374 8.67678 15.0303 8.96967C15.3232 9.26256 15.3232 9.73744 15.0303 10.0303L13.0606 12L15.0303 13.9696C15.3232 14.2625 15.3232 14.7374 15.0303 15.0303C14.7374 15.3232 14.2625 15.3232 13.9696 15.0303L12 13.0607L10.0303 15.0303C9.73742 15.3232 9.26254 15.3232 8.96965 15.0303C8.67676 14.7374 8.67676 14.2625 8.96965 13.9697L10.9393 12L8.96963 10.0303C8.67673 9.73742 8.67673 9.26254 8.96963 8.96965Z" fill="#1C274C"/>
           </svg>
         </div>

        
        <!-- inputs -->
         <!-- confirmation number -->
        <div class="flex flex-col mt-5">
          <label for="confirmationNum" class="font-semibold">N° de confirmación de reserva <span class="text-red-500">*</span></label>
          <input id="confirmationNum" name="confirmationNum" class="border p-1 bg-white" min="1" [(ngModel)]="inputValue" (input)="limitDigits()" [disabled]="enableEdition" [ngClass]="{'border-none bg-white': enableEdition}">
        </div>

        @if(!enableEdition){
          <p class="text-sm text-red-500 font-semibold"> {{ errMessage }} </p>
        }


        @if(enableEdition){
          <div class="flex flex-col">
            <!-- Thanks for your comment -->
            <h3 class="font-bold text-lg py-2">¡Gracias por tu comentario {{ customerName }}! </h3>
            <!-- comment -->
            <div class="flex flex-col">
              <label for="comment" class="font-semibold">Comentario <span class="text-red-500">*</span></label>
              <textarea name="comment" id="comment" class="resize-none border p-1" [(ngModel)]="reviewsFormData.comment" placeholder="Escribe tu opinión aquí. 4 letras como mínimo" rows="5"></textarea>
            </div>
            <!-- stars -->
            <div class="flex flex-col">
              <label for="stars" class="font-semibold">Estrellas <span class="text-red-500">*</span></label>
              <input type="number" id="stars" name="stars" class="border p-1" min="1" max="5" [(ngModel)]="reviewsFormData.stars" (change)="handleOverStars(reviewsFormData.stars)">
            </div>
    
            <h3> {{ "⭐".repeat(reviewsFormData.stars) }} </h3>
    

            <button class="bg-slate-900 hover:bg-slate-700 duration-200 text-white py-2 rounded mt-2"  [ngClass]="{'pointer-events-none bg-opacity-40': reviewsFormData.comment.length < 4}"> Enviar </button>
          </div>
        }

      </form>
    </div>
  }
</div>
